# éƒ¨ç½²æ•…éšœæ’æŸ¥æŒ‡å—

**æ—¥æœŸ**: 2026-01-13  
**é€‚ç”¨åœºæ™¯**: æœåŠ¡å™¨éƒ¨ç½²UXä¿®å¤åçš„é—®é¢˜æ’æŸ¥

---

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: git pull å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
error: Your local changes to the following files would be overwritten by merge
```

**åŸå› **: æœåŠ¡å™¨ä¸Šæœ‰æœªæäº¤çš„æœ¬åœ°ä¿®æ”¹

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ–¹æ¡ˆ1: æš‚å­˜æœ¬åœ°ä¿®æ”¹
git stash
git pull origin main
git stash pop

# æ–¹æ¡ˆ2: æ”¾å¼ƒæœ¬åœ°ä¿®æ”¹ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
git reset --hard HEAD
git pull origin main

# æ–¹æ¡ˆ3: æŸ¥çœ‹å…·ä½“å†²çª
git status
# æ‰‹åŠ¨å¤„ç†å†²çªæ–‡ä»¶
```

---

### é—®é¢˜2: npm run build å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
Error: ENOSPC: System limit for number of file watchers reached
```

**åŸå› **: ç³»ç»Ÿæ–‡ä»¶ç›‘è§†å™¨æ•°é‡é™åˆ¶

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å¢åŠ æ–‡ä»¶ç›‘è§†å™¨é™åˆ¶
echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

**é”™è¯¯ä¿¡æ¯**:
```
npm ERR! code ELIFECYCLE
```

**åŸå› **: æ„å»ºè¿‡ç¨‹ä¸­å‡ºé”™

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…é™¤ç¼“å­˜é‡è¯•
cd frontend/web
rm -rf node_modules
rm package-lock.json
npm install
npm run build
```

---

### é—®é¢˜3: pm2 restart åæœåŠ¡æ— æ³•å¯åŠ¨

**é”™è¯¯ä¿¡æ¯**:
```
status: errored
```

**æ’æŸ¥æ­¥éª¤**:

1. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**:
```bash
pm2 logs exam-helper-backend --lines 50
pm2 logs exam-helper-frontend --lines 50
```

2. **æ£€æŸ¥ç«¯å£å ç”¨**:
```bash
# æ£€æŸ¥3002ç«¯å£
netstat -tlnp | grep 3002

# å¦‚æœè¢«å ç”¨ï¼Œæ€æ‰è¿›ç¨‹
kill -9 <PID>
```

3. **æ£€æŸ¥æ–‡ä»¶æƒé™**:
```bash
ls -la /opt/exam-analysis-helper/backend/dist
ls -la /opt/exam-analysis-helper/frontend/web/dist
```

4. **æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•**:
```bash
# æµ‹è¯•åç«¯
cd /opt/exam-analysis-helper/backend
node dist/server.js

# å¦‚æœæŠ¥é”™ï¼Œæ£€æŸ¥é”™è¯¯ä¿¡æ¯
```

---

### é—®é¢˜4: æ•°æ®æ–‡ä»¶æ‰¾ä¸åˆ°

**é”™è¯¯ä¿¡æ¯**:
```
Error: ENOENT: no such file or directory, open '.../knowledge-points.json'
```

**åŸå› **: æ•°æ®æ–‡ä»¶æœªå¤åˆ¶åˆ° dist ç›®å½•

**è§£å†³æ–¹æ¡ˆ**:
```bash
cd /opt/exam-analysis-helper/backend

# æ£€æŸ¥æºæ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh data/knowledge-points.json

# åˆ›å»ºç›®å½•å¹¶å¤åˆ¶
mkdir -p dist/data
cp data/knowledge-points.json dist/data/

# éªŒè¯
ls -lh dist/data/knowledge-points.json

# é‡å¯æœåŠ¡
pm2 restart exam-helper-backend
```

---

### é—®é¢˜5: å‰ç«¯é¡µé¢æ˜¾ç¤ºæ—§ç‰ˆæœ¬

**åŸå› **: æµè§ˆå™¨ç¼“å­˜æˆ–CDNç¼“å­˜

**è§£å†³æ–¹æ¡ˆ**:

1. **æ£€æŸ¥æ„å»ºæ—¶é—´**:
```bash
ls -lh /opt/exam-analysis-helper/frontend/web/dist/index.html
# æŸ¥çœ‹æ–‡ä»¶ä¿®æ”¹æ—¶é—´æ˜¯å¦æ˜¯æœ€æ–°çš„
```

2. **æ¸…é™¤Nginxç¼“å­˜**ï¼ˆå¦‚æœä½¿ç”¨ï¼‰:
```bash
# é‡å¯Nginx
sudo systemctl restart nginx

# æˆ–æ¸…é™¤ç¼“å­˜ç›®å½•
sudo rm -rf /var/cache/nginx/*
```

3. **å¼ºåˆ¶æµè§ˆå™¨åˆ·æ–°**:
- ç”µè„‘ç«¯: Ctrl+Shift+R (Windows) æˆ– Cmd+Shift+R (Mac)
- æ‰‹æœºç«¯: å®Œå…¨å…³é—­æµè§ˆå™¨åº”ç”¨ï¼Œé‡æ–°æ‰“å¼€

4. **æ·»åŠ ç‰ˆæœ¬å·åˆ°URL**:
```
https://your-domain.com?v=20260113
```

---

### é—®é¢˜6: API è¿”å› 404

**é”™è¯¯ä¿¡æ¯**:
```
Cannot POST /api/analyze
```

**æ’æŸ¥æ­¥éª¤**:

1. **æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€**:
```bash
pm2 status
# ç¡®ä¿ exam-helper-backend æ˜¯ online çŠ¶æ€
```

2. **æ£€æŸ¥ç«¯å£ç›‘å¬**:
```bash
netstat -tlnp | grep 3002
# åº”è¯¥æ˜¾ç¤º node è¿›ç¨‹åœ¨ç›‘å¬ 3002 ç«¯å£
```

3. **æµ‹è¯•API**:
```bash
curl http://localhost:3002/health
# åº”è¯¥è¿”å› {"status":"ok",...}
```

4. **æ£€æŸ¥Nginxé…ç½®**ï¼ˆå¦‚æœä½¿ç”¨ï¼‰:
```bash
sudo nginx -t
# æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®

cat /etc/nginx/sites-available/exam-helper
# æŸ¥çœ‹åå‘ä»£ç†é…ç½®
```

---

### é—®é¢˜7: è®¿é—®å£ä»¤éªŒè¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
{"error":"è®¿é—®å£ä»¤æ— æ•ˆ"}
```

**æ’æŸ¥æ­¥éª¤**:

1. **æ£€æŸ¥ç¯å¢ƒå˜é‡**:
```bash
cd /opt/exam-analysis-helper/backend
cat .env | grep TRIAL_ACCESS_CODES
```

2. **éªŒè¯å£ä»¤æ ¼å¼**:
```bash
# å£ä»¤åº”è¯¥ç”¨é€—å·åˆ†éš”ï¼Œæ²¡æœ‰ç©ºæ ¼
# æ­£ç¡®: SX-T01-739184,SX-T02-582961
# é”™è¯¯: SX-T01-739184, SX-T02-582961 (æœ‰ç©ºæ ¼)
```

3. **æµ‹è¯•å£ä»¤**:
```bash
curl -X POST http://localhost:3002/api/analyze \
  -H "Content-Type: application/json" \
  -H "x-access-code: SX-T01-739184" \
  -d '{"images":[]}'

# å¦‚æœå£ä»¤æœ‰æ•ˆï¼Œåº”è¯¥è¿”å›:
# {"error":"è¯·æä¾›è‡³å°‘ä¸€å¼ å›¾ç‰‡"}
# è€Œä¸æ˜¯ {"error":"è®¿é—®å£ä»¤æ— æ•ˆ"}
```

4. **é‡å¯æœåŠ¡ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ**:
```bash
pm2 restart exam-helper-backend
```

---

### é—®é¢˜8: å†…å­˜ä¸è¶³

**é”™è¯¯ä¿¡æ¯**:
```
FATAL ERROR: Ineffective mark-compacts near heap limit
```

**åŸå› **: Node.js å†…å­˜é™åˆ¶

**è§£å†³æ–¹æ¡ˆ**:

1. **å¢åŠ Node.jså†…å­˜é™åˆ¶**:
```bash
# ç¼–è¾‘ PM2 é…ç½®
pm2 delete exam-helper-backend
pm2 start backend/dist/server.js \
  --name exam-helper-backend \
  --node-args="--max-old-space-size=2048"
```

2. **æ£€æŸ¥ç³»ç»Ÿå†…å­˜**:
```bash
free -h
# æŸ¥çœ‹å¯ç”¨å†…å­˜

df -h
# æŸ¥çœ‹ç£ç›˜ç©ºé—´
```

3. **æ¸…ç†æ—¥å¿—æ–‡ä»¶**:
```bash
pm2 flush
# æ¸…ç©ºPM2æ—¥å¿—

# æˆ–æ‰‹åŠ¨åˆ é™¤æ—§æ—¥å¿—
rm ~/.pm2/logs/*.log
```

---

### é—®é¢˜9: æ„å»ºé€Ÿåº¦æ…¢

**åŸå› **: æœåŠ¡å™¨æ€§èƒ½é™åˆ¶æˆ–ç½‘ç»œé—®é¢˜

**ä¼˜åŒ–æ–¹æ¡ˆ**:

1. **ä½¿ç”¨å›½å†…npmé•œåƒ**:
```bash
npm config set registry https://registry.npmmirror.com
```

2. **å‡å°‘å¹¶å‘æ„å»º**:
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export NODE_OPTIONS="--max-old-space-size=2048"

# ä½¿ç”¨å•çº¿ç¨‹æ„å»º
npm run build -- --no-parallel
```

3. **ä½¿ç”¨æœ¬åœ°æ„å»º**:
```bash
# åœ¨æœ¬åœ°ç”µè„‘æ„å»º
npm run build

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp -r dist root@172.16.0.196:/opt/exam-analysis-helper/frontend/web/
```

---

### é—®é¢˜10: æƒé™é—®é¢˜

**é”™è¯¯ä¿¡æ¯**:
```
EACCES: permission denied
```

**è§£å†³æ–¹æ¡ˆ**:

1. **æ£€æŸ¥æ–‡ä»¶æ‰€æœ‰è€…**:
```bash
ls -la /opt/exam-analysis-helper
```

2. **ä¿®æ”¹æ‰€æœ‰è€…**:
```bash
sudo chown -R root:root /opt/exam-analysis-helper
```

3. **ä¿®æ”¹æƒé™**:
```bash
chmod -R 755 /opt/exam-analysis-helper
```

---

## ğŸ”§ å®ç”¨è¯Šæ–­å‘½ä»¤

### ä¸€é”®å¥åº·æ£€æŸ¥
```bash
cd /opt/exam-analysis-helper

echo "=== PM2 æœåŠ¡çŠ¶æ€ ==="
pm2 status

echo -e "\n=== ç«¯å£ç›‘å¬ ==="
netstat -tlnp | grep -E "3002|5173"

echo -e "\n=== ç£ç›˜ç©ºé—´ ==="
df -h | grep -E "/$|/opt"

echo -e "\n=== å†…å­˜ä½¿ç”¨ ==="
free -h

echo -e "\n=== æœ€è¿‘çš„é”™è¯¯æ—¥å¿— ==="
pm2 logs exam-helper-backend --lines 10 --nostream --err

echo -e "\n=== API å¥åº·æ£€æŸ¥ ==="
curl -s http://localhost:3002/health | jq .

echo -e "\n=== æ•°æ®æ–‡ä»¶æ£€æŸ¥ ==="
ls -lh backend/dist/data/knowledge-points.json
```

### å®Œæ•´é‡å¯æµç¨‹
```bash
cd /opt/exam-analysis-helper

# åœæ­¢æ‰€æœ‰æœåŠ¡
pm2 stop all

# æ¸…ç†æ—¥å¿—
pm2 flush

# é‡æ–°å¯åŠ¨
pm2 start all

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs --lines 20
```

---

## ğŸ“ ç´§æ€¥å›æ»š

å¦‚æœéƒ¨ç½²åå‡ºç°ä¸¥é‡é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šï¼š

```bash
cd /opt/exam-analysis-helper

# åœæ­¢æœåŠ¡
pm2 stop all

# æ¢å¤å¤‡ä»½
cd ~
tar -xzf backups/frontend-backup-XXXXXX.tar.gz -C /opt/exam-analysis-helper/
tar -xzf backups/backend-backup-XXXXXX.tar.gz -C /opt/exam-analysis-helper/

# é‡å¯æœåŠ¡
cd /opt/exam-analysis-helper
pm2 restart all

# éªŒè¯
pm2 status
curl http://localhost:3002/health
```

---

## ğŸ“Š ç›‘æ§å»ºè®®

### è®¾ç½®æ—¥å¿—è½®è½¬
```bash
# å®‰è£… PM2 æ—¥å¿—è½®è½¬æ¨¡å—
pm2 install pm2-logrotate

# é…ç½®
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
pm2 set pm2-logrotate:compress true
```

### è®¾ç½®ç›‘æ§å‘Šè­¦
```bash
# ä½¿ç”¨ PM2 Plusï¼ˆå¯é€‰ï¼‰
pm2 link <secret> <public>

# æˆ–ä½¿ç”¨ç®€å•çš„ç›‘æ§è„šæœ¬
crontab -e
# æ·»åŠ : */5 * * * * /opt/exam-analysis-helper/health-check.sh
```

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·é€é¡¹æ£€æŸ¥ï¼š

- [ ] git pull æˆåŠŸï¼Œä»£ç å·²æ›´æ–°
- [ ] npm run build æˆåŠŸï¼Œæ— é”™è¯¯
- [ ] æ•°æ®æ–‡ä»¶å·²å¤åˆ¶åˆ° dist/data/
- [ ] pm2 status æ˜¾ç¤ºæ‰€æœ‰æœåŠ¡ online
- [ ] pm2 logs æ— é”™è¯¯ä¿¡æ¯
- [ ] curl http://localhost:3002/health è¿”å›æ­£å¸¸
- [ ] æµè§ˆå™¨è®¿é—®ç½‘ç«™æ­£å¸¸
- [ ] ä¸Šä¼ å›¾ç‰‡æµ‹è¯•åŠŸèƒ½æ­£å¸¸
- [ ] ä½ç½®ä¿¡åº¦å¯¹è¯æ¡†å¯ä»¥å…³é—­
- [ ] åé¦ˆæŒ‰é’®ä½ç½®æ­£å¸¸
- [ ] è®¿é—®å£ä»¤éªŒè¯æ­£å¸¸

---

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. **æ”¶é›†è¯Šæ–­ä¿¡æ¯**:
```bash
cd /opt/exam-analysis-helper
bash æœåŠ¡å™¨è¯Šæ–­å‘½ä»¤.sh > diagnostic-report.txt
```

2. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**:
```bash
pm2 logs exam-helper-backend --lines 100 > backend-logs.txt
pm2 logs exam-helper-frontend --lines 100 > frontend-logs.txt
```

3. **æä¾›ä»¥ä¸‹ä¿¡æ¯**:
   - é”™è¯¯æˆªå›¾
   - è¯Šæ–­æŠ¥å‘Š
   - æ—¥å¿—æ–‡ä»¶
   - æ“ä½œæ­¥éª¤

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æ›´æ–°æ—¥æœŸ**: 2026-01-13  
**ç»´æŠ¤è€…**: ç³»ç»Ÿç®¡ç†å‘˜
