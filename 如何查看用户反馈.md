# å¦‚ä½•æŸ¥çœ‹ç”¨æˆ·åé¦ˆ

**æ—¥æœŸ**: 2026-01-12  
**ç›®æ ‡**: å¸®åŠ©å¼€å‘è€…äº†è§£å¦‚ä½•æŸ¥çœ‹å’Œåˆ†æç”¨æˆ·åé¦ˆ

---

## ğŸ“Š åé¦ˆç³»ç»Ÿæ¦‚è¿°

ç”¨æˆ·åé¦ˆç³»ç»Ÿå·²ç»å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬ï¼š
- âœ… å‰ç«¯åé¦ˆæŒ‰é’®å’Œè¡¨å•
- âœ… åç«¯åé¦ˆæ”¶é›†API
- âœ… åé¦ˆæ•°æ®æŒä¹…åŒ–å­˜å‚¨
- âœ… åé¦ˆæ‘˜è¦æŸ¥è¯¢æ¥å£

---

## ğŸ“ åé¦ˆæ•°æ®å­˜å‚¨ä½ç½®

### å­˜å‚¨æ–‡ä»¶
```
data/feedbacks/user-feedbacks.jsonl
```

### æ–‡ä»¶æ ¼å¼
- **æ ¼å¼**: JSONL (JSON Lines)
- **ç¼–ç **: UTF-8
- **ç»“æ„**: æ¯è¡Œä¸€ä¸ªJSONå¯¹è±¡

### æ•°æ®ç»“æ„
```json
{
  "id": "fb_1736668800000_a1b2c3d4",
  "timestamp": 1736668800000,
  "analysisId": "job_abc123",
  "feedbackType": "accuracy",
  "rating": 4,
  "content": "åˆ†æç»“æœå¾ˆå‡†ç¡®ï¼Œä½†å»ºè®®å¢åŠ æ›´å¤šç»ƒä¹ é¢˜",
  "specificIssues": ["ç»ƒä¹ é¢˜æ•°é‡", "éš¾åº¦æ¢¯åº¦"],
  "userInfo": {
    "grade": "ä¸ƒå¹´çº§",
    "subject": "æ•°å­¦",
    "deviceType": "desktop"
  },
  "metadata": {}
}
```

---

## ğŸ” æŸ¥çœ‹åé¦ˆçš„æ–¹æ³•

### æ–¹æ³•1: ç›´æ¥æŸ¥çœ‹æ–‡ä»¶ï¼ˆæ¨èï¼‰

#### ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨
```bash
# Windows
notepad data\feedbacks\user-feedbacks.jsonl

# æˆ–ä½¿ç”¨ VS Code
code data\feedbacks\user-feedbacks.jsonl
```

#### ä½¿ç”¨å‘½ä»¤è¡Œ
```bash
# Windows PowerShell - æŸ¥çœ‹æ‰€æœ‰åé¦ˆ
Get-Content data\feedbacks\user-feedbacks.jsonl

# Windows PowerShell - æŸ¥çœ‹æœ€è¿‘10æ¡
Get-Content data\feedbacks\user-feedbacks.jsonl | Select-Object -Last 10

# Windows CMD
type data\feedbacks\user-feedbacks.jsonl
```

---

### æ–¹æ³•2: ä½¿ç”¨APIæ¥å£

#### 2.1 è·å–åé¦ˆæ‘˜è¦

**æ¥å£**: `GET /api/feedback/summary`

**è¯·æ±‚ç¤ºä¾‹**:
```bash
# ä½¿ç”¨ curl
curl http://localhost:3002/api/feedback/summary

# ä½¿ç”¨ PowerShell
Invoke-RestMethod -Uri "http://localhost:3002/api/feedback/summary" -Method Get
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "totalFeedbacks": 15,
    "averageRating": 4.2,
    "feedbacksByType": {
      "accuracy": 5,
      "quality": 3,
      "suggestion": 4,
      "bug": 2,
      "other": 1
    },
    "recentFeedbacks": [
      {
        "id": "fb_1736668800000_a1b2c3d4",
        "timestamp": 1736668800000,
        "feedbackType": "accuracy",
        "rating": 4,
        "content": "åˆ†æç»“æœå¾ˆå‡†ç¡®...",
        "userInfo": {
          "grade": "ä¸ƒå¹´çº§",
          "subject": "æ•°å­¦"
        }
      }
    ]
  }
}
```

#### 2.2 åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:3002/api/feedback/summary
```

---

### æ–¹æ³•3: ä½¿ç”¨Node.jsè„šæœ¬

åˆ›å»ºä¸€ä¸ªæŸ¥çœ‹è„šæœ¬ `view-feedbacks.js`:

```javascript
const fs = require('fs');
const path = require('path');

// è¯»å–åé¦ˆæ–‡ä»¶
const feedbackFile = path.join(__dirname, 'data', 'feedbacks', 'user-feedbacks.jsonl');

if (!fs.existsSync(feedbackFile)) {
  console.log('âŒ è¿˜æ²¡æœ‰æ”¶åˆ°ä»»ä½•åé¦ˆ');
  process.exit(0);
}

const content = fs.readFileSync(feedbackFile, 'utf-8');
const lines = content.trim().split('\n').filter(line => line.trim());

console.log(`\nğŸ“Š æ€»å…±æ”¶åˆ° ${lines.length} æ¡åé¦ˆ\n`);
console.log('=' .repeat(80));

lines.forEach((line, index) => {
  try {
    const feedback = JSON.parse(line);
    const date = new Date(feedback.timestamp).toLocaleString('zh-CN');
    
    console.log(`\nåé¦ˆ #${index + 1}`);
    console.log(`ID: ${feedback.id}`);
    console.log(`æ—¶é—´: ${date}`);
    console.log(`ç±»å‹: ${feedback.feedbackType}`);
    console.log(`è¯„åˆ†: ${feedback.rating ? 'â­'.repeat(feedback.rating) : 'æœªè¯„åˆ†'}`);
    console.log(`å†…å®¹: ${feedback.content}`);
    
    if (feedback.specificIssues && feedback.specificIssues.length > 0) {
      console.log(`å…·ä½“é—®é¢˜: ${feedback.specificIssues.join(', ')}`);
    }
    
    if (feedback.userInfo) {
      console.log(`ç”¨æˆ·ä¿¡æ¯: ${feedback.userInfo.grade || ''} ${feedback.userInfo.subject || ''}`);
    }
    
    console.log('-'.repeat(80));
  } catch (e) {
    console.error(`è§£æåé¦ˆå¤±è´¥: ${line.substring(0, 50)}`);
  }
});

// ç»Ÿè®¡ä¿¡æ¯
const feedbacks = lines.map(line => {
  try {
    return JSON.parse(line);
  } catch {
    return null;
  }
}).filter(Boolean);

const byType = {};
feedbacks.forEach(f => {
  byType[f.feedbackType] = (byType[f.feedbackType] || 0) + 1;
});

const ratings = feedbacks.filter(f => f.rating).map(f => f.rating);
const avgRating = ratings.length > 0 
  ? (ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(1)
  : 'æ— ';

console.log(`\nğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯:`);
console.log(`æ€»åé¦ˆæ•°: ${feedbacks.length}`);
console.log(`å¹³å‡è¯„åˆ†: ${avgRating}`);
console.log(`æŒ‰ç±»å‹åˆ†å¸ƒ:`);
Object.entries(byType).forEach(([type, count]) => {
  console.log(`  - ${type}: ${count}`);
});
console.log('');
```

**è¿è¡Œè„šæœ¬**:
```bash
node view-feedbacks.js
```

---

## ğŸ“‹ åé¦ˆç±»å‹è¯´æ˜

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `accuracy` | å‡†ç¡®æ€§é—®é¢˜ | "è¯†åˆ«çš„å¹´çº§ä¸å¯¹" |
| `quality` | è´¨é‡é—®é¢˜ | "åˆ†æä¸å¤Ÿæ·±å…¥" |
| `suggestion` | æ”¹è¿›å»ºè®® | "å¸Œæœ›å¢åŠ æ›´å¤šç»ƒä¹ é¢˜" |
| `bug` | ç¨‹åºé”™è¯¯ | "ç‚¹å‡»æŒ‰é’®æ²¡ååº”" |
| `other` | å…¶ä»–åé¦ˆ | "ç•Œé¢å¾ˆå¥½çœ‹" |

---

## ğŸ“Š åé¦ˆæ•°æ®åˆ†æ

### ä½¿ç”¨Excelåˆ†æ

1. **å¯¼å‡ºä¸ºCSV**:
   åˆ›å»º `export-feedbacks-csv.js`:
   ```javascript
   const fs = require('fs');
   const path = require('path');
   
   const feedbackFile = path.join(__dirname, 'data', 'feedbacks', 'user-feedbacks.jsonl');
   const csvFile = path.join(__dirname, 'data', 'feedbacks', 'feedbacks.csv');
   
   if (!fs.existsSync(feedbackFile)) {
     console.log('æ²¡æœ‰åé¦ˆæ•°æ®');
     process.exit(0);
   }
   
   const content = fs.readFileSync(feedbackFile, 'utf-8');
   const lines = content.trim().split('\n').filter(line => line.trim());
   
   // CSV è¡¨å¤´
   const csv = ['ID,æ—¶é—´,ç±»å‹,è¯„åˆ†,å†…å®¹,å¹´çº§,å­¦ç§‘'];
   
   lines.forEach(line => {
     try {
       const f = JSON.parse(line);
       const date = new Date(f.timestamp).toLocaleString('zh-CN');
       const row = [
         f.id,
         date,
         f.feedbackType,
         f.rating || '',
         `"${(f.content || '').replace(/"/g, '""')}"`,
         f.userInfo?.grade || '',
         f.userInfo?.subject || ''
       ].join(',');
       csv.push(row);
     } catch (e) {}
   });
   
   fs.writeFileSync(csvFile, '\uFEFF' + csv.join('\n'), 'utf-8');
   console.log(`âœ… å¯¼å‡ºæˆåŠŸ: ${csvFile}`);
   ```

2. **è¿è¡Œå¯¼å‡º**:
   ```bash
   node export-feedbacks-csv.js
   ```

3. **ç”¨Excelæ‰“å¼€**: `data/feedbacks/feedbacks.csv`

---

## ğŸ”” å®æ—¶ç›‘æ§åé¦ˆ

### åˆ›å»ºç›‘æ§è„šæœ¬

åˆ›å»º `watch-feedbacks.js`:

```javascript
const fs = require('fs');
const path = require('path');

const feedbackFile = path.join(__dirname, 'data', 'feedbacks', 'user-feedbacks.jsonl');
let lastSize = 0;

console.log('ğŸ‘€ å¼€å§‹ç›‘æ§ç”¨æˆ·åé¦ˆ...\n');

// ç¡®ä¿æ–‡ä»¶å­˜åœ¨
if (!fs.existsSync(feedbackFile)) {
  fs.mkdirSync(path.dirname(feedbackFile), { recursive: true });
  fs.writeFileSync(feedbackFile, '', 'utf-8');
}

// åˆå§‹å¤§å°
if (fs.existsSync(feedbackFile)) {
  lastSize = fs.statSync(feedbackFile).size;
}

// ç›‘æ§æ–‡ä»¶å˜åŒ–
fs.watch(feedbackFile, (eventType) => {
  if (eventType === 'change') {
    const currentSize = fs.statSync(feedbackFile).size;
    
    if (currentSize > lastSize) {
      // è¯»å–æ–°å¢çš„å†…å®¹
      const content = fs.readFileSync(feedbackFile, 'utf-8');
      const lines = content.trim().split('\n');
      const lastLine = lines[lines.length - 1];
      
      try {
        const feedback = JSON.parse(lastLine);
        const date = new Date(feedback.timestamp).toLocaleString('zh-CN');
        
        console.log('\nğŸ”” æ”¶åˆ°æ–°åé¦ˆ!');
        console.log(`æ—¶é—´: ${date}`);
        console.log(`ç±»å‹: ${feedback.feedbackType}`);
        console.log(`è¯„åˆ†: ${feedback.rating ? 'â­'.repeat(feedback.rating) : 'æœªè¯„åˆ†'}`);
        console.log(`å†…å®¹: ${feedback.content}`);
        console.log('-'.repeat(60));
      } catch (e) {
        console.error('è§£æåé¦ˆå¤±è´¥');
      }
      
      lastSize = currentSize;
    }
  }
});

console.log('ç›‘æ§ä¸­... (æŒ‰ Ctrl+C é€€å‡º)');
```

**è¿è¡Œç›‘æ§**:
```bash
node watch-feedbacks.js
```

---

## ğŸ¯ å¿«é€ŸæŸ¥çœ‹æœ€æ–°åé¦ˆ

### PowerShell ä¸€è¡Œå‘½ä»¤

```powershell
# æŸ¥çœ‹æœ€æ–°1æ¡åé¦ˆï¼ˆæ ¼å¼åŒ–ï¼‰
Get-Content data\feedbacks\user-feedbacks.jsonl | Select-Object -Last 1 | ConvertFrom-Json | Format-List

# æŸ¥çœ‹æœ€æ–°5æ¡åé¦ˆ
Get-Content data\feedbacks\user-feedbacks.jsonl | Select-Object -Last 5 | ForEach-Object { ConvertFrom-Json $_ } | Format-Table -Property feedbackType, rating, content -AutoSize
```

---

## ğŸ“ˆ åé¦ˆæ•°æ®å¤‡ä»½

### å®šæœŸå¤‡ä»½è„šæœ¬

åˆ›å»º `backup-feedbacks.js`:

```javascript
const fs = require('fs');
const path = require('path');

const feedbackFile = path.join(__dirname, 'data', 'feedbacks', 'user-feedbacks.jsonl');
const backupDir = path.join(__dirname, 'data', 'feedbacks', 'backups');

if (!fs.existsSync(feedbackFile)) {
  console.log('æ²¡æœ‰åé¦ˆæ•°æ®éœ€è¦å¤‡ä»½');
  process.exit(0);
}

// åˆ›å»ºå¤‡ä»½ç›®å½•
if (!fs.existsSync(backupDir)) {
  fs.mkdirSync(backupDir, { recursive: true });
}

// ç”Ÿæˆå¤‡ä»½æ–‡ä»¶å
const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T')[0];
const backupFile = path.join(backupDir, `user-feedbacks-${timestamp}.jsonl`);

// å¤åˆ¶æ–‡ä»¶
fs.copyFileSync(feedbackFile, backupFile);

console.log(`âœ… å¤‡ä»½æˆåŠŸ: ${backupFile}`);
```

**è¿è¡Œå¤‡ä»½**:
```bash
node backup-feedbacks.js
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: åé¦ˆæ–‡ä»¶ä¸å­˜åœ¨ï¼Ÿ
**A**: è¿™æ˜¯æ­£å¸¸çš„ï¼Œæ–‡ä»¶ä¼šåœ¨æ”¶åˆ°ç¬¬ä¸€æ¡åé¦ˆæ—¶è‡ªåŠ¨åˆ›å»ºã€‚

### Q2: å¦‚ä½•æ¸…ç©ºæ‰€æœ‰åé¦ˆï¼Ÿ
**A**: åˆ é™¤æˆ–é‡å‘½åæ–‡ä»¶ï¼š
```bash
# å¤‡ä»½åæ¸…ç©º
move data\feedbacks\user-feedbacks.jsonl data\feedbacks\user-feedbacks-backup.jsonl
```

### Q3: åé¦ˆæ•°æ®ä¼šå ç”¨å¤šå°‘ç©ºé—´ï¼Ÿ
**A**: æ¯æ¡åé¦ˆçº¦ 500-1000 å­—èŠ‚ï¼Œ1000æ¡åé¦ˆçº¦ 0.5-1 MBã€‚

### Q4: å¦‚ä½•å¯¼å…¥åˆ°æ•°æ®åº“ï¼Ÿ
**A**: JSONLæ ¼å¼å¯ä»¥ç›´æ¥å¯¼å…¥MongoDBã€PostgreSQLç­‰æ•°æ®åº“ã€‚

---

## ğŸ“ åé¦ˆæ•°æ®éšç§

### æ³¨æ„äº‹é¡¹
- âœ… åé¦ˆæ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸ä¼šè‡ªåŠ¨ä¸Šä¼ 
- âœ… ç”¨æˆ·ä¿¡æ¯æ˜¯å¯é€‰çš„ï¼Œå¯èƒ½ä¸ºç©º
- âœ… ä¸åŒ…å«ä¸ªäººèº«ä»½ä¿¡æ¯ï¼ˆPIIï¼‰
- âš ï¸ åé¦ˆå†…å®¹å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œè¯·å¦¥å–„ä¿ç®¡

### æ•°æ®ä¿æŠ¤å»ºè®®
1. å®šæœŸå¤‡ä»½åé¦ˆæ•°æ®
2. ä¸è¦å°†åé¦ˆæ–‡ä»¶æäº¤åˆ°å…¬å¼€ä»“åº“
3. åœ¨ `.gitignore` ä¸­æ·»åŠ ï¼š
   ```
   data/feedbacks/
   ```

---

## ğŸ‰ æ€»ç»“

ç°åœ¨ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹ç”¨æˆ·åé¦ˆï¼š

1. **æœ€ç®€å•**: ç›´æ¥æ‰“å¼€ `data/feedbacks/user-feedbacks.jsonl`
2. **æœ€ç›´è§‚**: è®¿é—® `http://localhost:3002/api/feedback/summary`
3. **æœ€çµæ´»**: ä½¿ç”¨æä¾›çš„Node.jsè„šæœ¬
4. **æœ€ä¸“ä¸š**: å¯¼å‡ºä¸ºCSVç”¨Excelåˆ†æ

é€‰æ‹©æœ€é€‚åˆä½ çš„æ–¹å¼ï¼Œå¼€å§‹æ”¶é›†å’Œåˆ†æç”¨æˆ·åé¦ˆå§ï¼

---

**åˆ›å»ºæ—¶é—´**: 2026-01-12  
**ç›¸å…³æ–‡ä»¶**:
- `backend/core/feedback-collector.ts` - åé¦ˆæ”¶é›†å™¨å®ç°
- `backend/server.ts` - åé¦ˆAPIæ¥å£
- `frontend/web/src/components/FeedbackForm.tsx` - åé¦ˆè¡¨å•
- `frontend/web/src/components/FeedbackButton.tsx` - åé¦ˆæŒ‰é’®
