# 项目日常管理与维护手册 (初学者版)

本文档专为项目维护者编写，涵盖**本地开发环境**与**阿里云生产环境**的常用操作、注意事项及故障排查指南。即使你没有深厚的技术背景，照着本手册也能完成 90% 的日常维护工作。

---

## 第一部分：本地开发环境 (你的电脑)

### 1. 启动项目 (开始工作)
你需要打开两个终端窗口（或在 VS Code 中打开两个终端），分别启动前端和后端。

**启动后端 (提供数据接口)**
```powershell
# 1. 进入后端目录
cd backend

# 2. 启动服务 (默认端口 3002)
npm run dev
```
> **成功标志**：看到终端输出 `🚀 后端服务已启动: http://localhost:3002`

**启动前端 (显示网页界面)**
```powershell
# 1. 进入前端目录
cd frontend/web

# 2. 启动网页 (默认端口 5173)
npm run dev
```
> **成功标志**：看到终端输出 `➜  Local:   http://localhost:5173/`，按住 Ctrl 点击链接即可在浏览器打开。

### 2. 停止项目 (结束工作)
- 在运行命令的终端窗口中，点击一下鼠标让光标聚焦。
- 按下键盘上的 `Ctrl + C`。
- 如果提示 `终止批处理操作吗 (Y/N)?`，输入 `y` 并回车。
- 前后端两个窗口都要执行此操作。

### 3. 常见问题 (本地)
- **问题：启动时提示 "EADDRINUSE: address already in use" (端口被占用)**
  - **原因**：上次关闭不彻底，旧的进程还在后台运行。
  - **解决**：重启电脑（最简单），或者在终端执行 `npx kill-port 3002 5173`。
- **问题：页面显示“今日额度已用完”**
  - **解决**：这是后端为了防止滥用设置的限制。本地测试时，可以这样启动后端来忽略限制：
    ```powershell
    $env:DISABLE_RATE_LIMIT=1; npm run dev
    ```

---

## 第二部分：阿里云服务器 (线上环境)

### 1. 登录服务器
你需要使用 SSH 工具登录到云服务器。
```bash
ssh root@123.56.45.212
# 输入密码后回车 (密码输入时屏幕上不会显示字符，这是正常的)
```

### 2. 更新代码 (发布新版本)
当你（或开发者）在本地修改了代码并推送到 GitHub 后，需要在服务器上同步更新。

**步骤 1：拉取最新代码**
```bash
# 进入项目目录
cd /opt/exam-analysis-helper

# 拉取更新 (如果失败请多试几次)
git pull origin main
```
> *如果提示 `fatal: unable to access`，请尝试执行 `git config --global http.version HTTP/1.1` 后重试。*

**步骤 2：重新构建并重启**
```bash
# 1. 构建前端
cd frontend/web
npm install   # (偶尔运行一次即可，确保依赖最新)
npm run build

# 2. 构建后端
cd ../../backend
npm install   # (同上)
npm run build

# 3. 重启所有服务 (让更新生效)
pm2 restart all
```

### 3. 查看运行状态
想知道服务是不是活着？有没有报错？
```bash
# 查看进程列表 (Status 应为 online)
pm2 list

# 查看实时日志 (按 Ctrl + C 退出)
pm2 logs
```

### 4. 紧急故障处理
- **服务器完全没反应/连不上**：登录阿里云网页控制台，强制重启实例。
- **服务挂了但服务器能连上**：执行 `pm2 resurrect` (复活) 或 `pm2 restart all`。
- **磁盘满了**：执行 `pm2 flush` 清理日志缓存。

---

## 第三部分：注意事项与安全

1. **不要在代码里提交密码**：`.env` 文件里存放了 API Key 和密码，这个文件**永远不要**提交到 GitHub。
2. **定期备份**：虽然代码在 GitHub 有备份，但服务器上的数据（如果有数据库文件）建议定期下载到本地。
3. **保持更新**：定期在服务器上执行 `apt update && apt upgrade` (小白慎用，建议在专人指导下进行)。

---

## 第四部分：今日工作总结 (2026-01-10)

我们今天完成了以下关键任务：
1. **修复显示问题**：彻底解决了数学公式（LaTeX）中出现红色乱码、`\f` 符号、`imes` 符号等问题，现在公式显示非常完美。
2. **优化限额策略**：修改了后端逻辑，不再把“查询进度”的请求计入日额度，解决了“点几下就提示额度用完”的 Bug。
3. **代码同步**：将所有本地修复提交到了 GitHub 仓库 (`main` 分支)。
4. **线上部署**：在阿里云服务器上成功拉取了最新代码，并重新构建发布。现在线上版本已包含所有修复。
