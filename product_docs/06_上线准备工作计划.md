# 上线测试准备工作计划 (Pre-Launch Plan)

## 1. 项目阶段定位：MVP+ (Pre-Beta)

**当前版本**: V1.5.1
**核心状态**: 核心业务闭环已跑通，UI/UX 经过一轮深度优化（HUD 风格、移动端适配），具备小范围公测条件。

### ✅ 已就绪核心功能 (Ready for Launch)
1.  **智能诊断闭环**:
    *   [x] 多模态试卷分析 (OCR + LLM)。
    *   [x] 结构化报告生成 (四要素：错因、证据、置信度、改法)。
    *   [x] 自动生成变式训练题。
    *   [x] 验收小测与二次训练触发机制。
2.  **交互与体验**:
    *   [x] **HUD 指挥舱界面**: 玻璃拟态设计，沉浸式体验。
    *   [x] **响应式布局**: 适配桌面端 (三栏) 与 移动端 (单栏+弹窗)。
    *   [x] **侧边栏导航**: 可折叠、可左右切换的悬浮菜单。
3.  **家长驾驶舱**:
    *   [x] 四维数据监控 (完成率、通过率、趋势、预告)。
4.  **基础设置**:
    *   [x] 学生档案管理 (本地存储)。
    *   [x] 大模型配置 (自定义 Key)。

### ⏸️ 搁置/下一代功能 (Deferred to V2.0)
> 以下功能确认为 V2.0 规划，本次上线测试**不包含**，避免需求蔓延。

1.  **云端同步**: 多设备数据互通 (需后端数据库支持)。
2.  **高级错题本**: 自定义标签系统、一键导出高清去手写 PDF。
3.  **社区互动**: 班级圈、作业分享。
4.  **全科深度适配**: 目前主要优化语数英，政史地生仅提供通用支持。
5.  **原生 App**: 小程序/App 暂不开发，专注 Web/H5 体验。

---

## 2. 上线测试工作计划 (Work Plan)

### 阶段一：功能验收 (Functionality QA)
*   **目标**: 确保所有“已就绪”功能无致命 Bug。
*   **任务清单**:
    *   [x] **冒烟测试**: 完整跑通“上传 -> 分析 -> 训练 -> 验收”流程，确保不白屏、不卡死。 (后端 API 验证通过，前端构建通过)
    *   [x] **交互回归**: 重点测试新版侧边栏 (左右切换、展开/收起) 在不同分辨率下的表现。 (代码逻辑静态审查通过，需人工最终确认)
    *   [x] **Bug修复**: 修复报告页 React 对象渲染错误 (guidance 字段兼容性处理)。
    *   [x] **移动端适配**: 在手机浏览器 (iOS Safari/Chrome) 中验证上传图片、拖拽、滚动的流畅度。 (用户验证通过)
    *   [x] **异常处理**: 已补齐断网/超时/口令错误/频控/配置缺失等场景的 Toast 提示（替换 alert）。

### 阶段二：性能与兼容性 (Performance & Compatibility)
*   **目标**: 确保在主流设备上体验流畅。
*   **任务清单**:
    *   [x] **加载速度**: 粗检构建产物体积：主 JS ~305KB（gzip ~98KB），CSS ~35KB（gzip ~7.6KB）。
    *   [ ] **内存泄漏**: 长时间运行（多次分析后）检查页面是否卡顿。
    *   [ ] **浏览器兼容**: 验证 Chrome, Edge, Safari (Mobile) 的显示效果。

### 阶段三：部署准备 (Deployment Prep)
*   **目标**: 确保项目可被用户轻松部署或访问。
*   **线上信息**:
    *   **Repo**: `https://github.com/litongxue7788/exam-analysis-helper`
    *   **Server**: 阿里云 ECS (`i-2ze430a8moubrvgp8nns`)
*   **任务清单**:
    *   [ ] **环境变量检查**: 确认 `.env.example` 完整且敏感信息已脱敏。
    *   [x] **构建脚本验证**: 前后端 `typecheck/build` 已通过，前端产物 `dist` 可正常生成。
    *   [ ] **数据清理**: 提供“重置/清除缓存”功能（或文档说明），方便测试人员重置环境。

### 阶段四：文档完善 (Documentation)
*   **目标**: 降低用户上手门槛。
*   **任务清单**:
    *   [ ] **更新 README.md**: 反映最新 V1.5.1 特性与截图。
    *   [x] **用户操作指引**: 已输出简易“三步上手”指南。

---

## 3. 执行时间表 (Timeline)

*   **T+1 (今日)**: 完成所有文档更新，进行内部冒烟测试。
*   **T+2**: 修复冒烟测试发现的高优 Bug，进行移动端专项测试。
*   **T+3**: 封版 (Code Freeze)，准备发布 Release 版本。

---

## 4. 日常运维与日程维护 (Ops Routine)

> 目标：让线上环境长期稳定、可回滚、可追踪。

### 4.1 线上服务组成

*   **前端**: Nginx 静态托管 `frontend/web/dist`
*   **后端**: pm2 守护 `backend/dist/server.js`（监听 `3002`）
*   **反代约定**: Nginx 将 `/api/*` 反代到 `http://127.0.0.1:3002/api/*`

### 4.2 每日例行（5-10 分钟）

1. **服务健康**
   - `curl -f http://127.0.0.1:3002/`
   - `curl -I http://127.0.0.1/ | head -n 5`
2. **进程状态**
   - `pm2 status`
   - `pm2 logs exam-helper-backend --lines 50`
3. **异常告警处理**
   - 若出现大量 401：确认访问口令策略与用户设置一致（`TRIAL_ACCESS_CODES` / `TRIAL_ACCESS_CODE`）。
   - 若出现 413：增大 Nginx `client_max_body_size`，并提示用户减少图片数量。
   - 若出现 429：根据使用强度调整频控/额度（见 4.5）。

### 4.3 每周例行（30 分钟）

1. **发布节奏**
   - 固定每周 1 次小版本更新，避免频繁打扰测试者。
2. **日志回看**
   - Nginx: `/var/log/nginx/access.log`、`/var/log/nginx/error.log`
   - pm2: `pm2 logs --lines 200`
3. **依赖安全**
   - 前后端分别执行 `npm audit`，评估是否需要升级依赖。

### 4.4 发布流程（GitHub -> ECS）

1. **拉取与对齐**
   - `cd /opt/exam-analysis-helper`
   - `git fetch origin`
   - `git reset --hard origin/main`
2. **后端发布**
   - `cd backend && npm install && npm run typecheck && npm run build`
   - `pm2 restart exam-helper-backend`
3. **前端发布**
   - `cd frontend/web && npm install && npm run typecheck && npm run build`
   - `systemctl reload nginx`
4. **发布后验证**
   - `curl -f http://127.0.0.1:3002/`
   - `curl -I http://127.0.0.1/ | head -n 20`

### 4.5 核心环境变量清单（不写入仓库）

*   **大模型配置**: `DOUBAO_API_KEY` / `DOUBAO_MODEL_ID` / `ALIYUN_API_KEY` / `ZHIPU_API_KEY` 等
*   **访问口令**: `TRIAL_ACCESS_CODES`（逗号分隔）或 `TRIAL_ACCESS_CODE`（单个）
*   **管理员口令**: `ADMIN_PASSWORD`
*   **超时与限流**:
    - `LLM_TIMEOUT_MS`
    - `RATE_LIMIT_PER_MINUTE_PER_CODE` / `RATE_LIMIT_PER_MINUTE_PER_IP`
    - `DAILY_QUOTA_PER_CODE` / `DAILY_QUOTA_PER_IP`

### 4.6 回滚策略（2 分钟内恢复）

*   **GitHub 层面**: 使用备份分支回滚（例如 `backup-YYYYMMDD`）。
*   **ECS 层面**:
   1. `git reset --hard origin/backup-YYYYMMDD`
   2. 重跑后端/前端构建
   3. `pm2 restart exam-helper-backend && systemctl reload nginx`

---

## 5. 一轮线上测试安排与达标标准 (Online Test)

### 5.1 测试目标与范围

*   **目标**: 验证“上传/导入 -> 分析 -> 训练 -> 验收 -> 家长驾驶舱”闭环的可用性、稳定性与理解成本。
*   **范围**: V1.5.1 已就绪功能，不包含 V2.0 规划功能（云同步/高级错题本/社区等）。

### 5.2 测试周期（建议 7 天）

*   **D1**: 试用引导 + 首次上传/导入与报告生成
*   **D2-D5**: 每天完成 1 次“训练 + 验收”小闭环
*   **D6**: 家长视角回看趋势与任务完成情况
*   **D7**: 汇总反馈与封版评审

### 5.3 测试对象与设备矩阵

*   **对象**: 5-15 个家庭（每个家庭 1 位学生 + 1 位家长）
*   **设备**:
   - 电脑端：Chrome / Edge
   - 手机端：iOS Safari / Android Chrome

### 5.4 必测用例（所有测试者都要跑）

1. 图片上传 1-3 张并生成报告
2. 表格导入（CSV）并生成报告
3. 从报告页进入“练一练”，生成练习题并完成一次验收
4. 切换考试记录，回看历史报告
5. 打开家长驾驶舱，确认四维指标可读

### 5.5 达标标准（Go/No-Go）

**可用性**
*   80% 以上测试者可在 10 分钟内独立完成首次报告生成（无需技术陪同）。
*   “访问口令 / 配置缺失 / 频控”提示能让用户下一步知道怎么做（不出现无意义报错）。

**稳定性**
*   报告生成成功率 ≥ 95%（剔除明确的口令错误与主动取消）。
*   连续 3 天使用无“白屏/卡死/无法恢复”的 P0 故障。

**性能**
*   首页首屏可交互时间 ≤ 3s（主流手机/电脑网络正常情况下）。
*   单次分析（1-3 张图）平均耗时 ≤ 60s；P95 ≤ 120s。

**体验**
*   训练/验收链路中，用户能明确知道“下一步是什么”，并能回到首页/报告页不迷路。
*   导出/打印在电脑端可用（能生成 PDF）。

### 5.6 反馈收集模板（建议统一口径）

*   环境：设备型号 / 浏览器 / 网络（Wi-Fi/4G）
*   任务：上传/导入/分析/训练/验收/导出
*   结果：成功/失败（附截图或错误提示）
*   体感：是否清楚下一步、哪里最困惑、最想要的改进点
