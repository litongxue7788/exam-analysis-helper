# 年级识别测试指南

## 📋 测试目的

验证年级识别优化后，系统能够正确识别高中试卷，避免将高二试卷误判为初二或小学。

---

## 🎯 测试目标

| 指标 | 目标值 |
|------|--------|
| 年级识别准确率 | ≥95% |
| 识别置信度 | ≥85% |
| 知识点提取数量 | ≥10个（高中试卷） |
| 质量评分 | ≥90/100 |
| 无跨学段误判 | 100% |

---

## 🧪 测试场景

### 场景1: 高二数学试卷（用户提供）

**测试文件**: 用户提供的4张高二数学试卷图片

**预期结果**:
- ✅ 年级识别: 高二
- ✅ 学科识别: 数学
- ✅ 识别置信度: ≥85%
- ✅ 知识点提取: ≥10个
- ✅ 包含知识点: 圆锥曲线、椭圆、双曲线、抛物线、函数等
- ✅ 质量评分: ≥90/100

**测试步骤**:
1. 打开浏览器访问: http://localhost:3000
2. 上传4张试卷图片
3. 等待分析完成
4. 检查后端日志中的年级识别结果
5. 检查知识点提取数量和内容
6. 检查质量评分

**验证命令**:
```bash
# 查看后端日志
node test_p1_real.js
```

---

### 场景2: 高一数学试卷

**测试内容**: 包含集合、函数、三角函数、向量等知识点

**预期结果**:
- ✅ 年级识别: 高一
- ✅ 识别置信度: ≥85%
- ✅ 知识点: 集合、函数性质、三角函数、向量

---

### 场景3: 高三数学试卷

**测试内容**: 包含导数应用、积分、极限等知识点

**预期结果**:
- ✅ 年级识别: 高三
- ✅ 识别置信度: ≥85%
- ✅ 知识点: 导数、积分、极限

---

### 场景4: 初二数学试卷（验证无误判）

**测试内容**: 包含一元二次方程、函数、三角形等知识点

**预期结果**:
- ✅ 年级识别: 初二（不应误判为高二）
- ✅ 识别置信度: ≥80%
- ✅ 知识点: 一元二次方程、函数、三角形

---

### 场景5: 小学三年级数学试卷（验证无误判）

**测试内容**: 包含加减乘除、图形等知识点

**预期结果**:
- ✅ 年级识别: 三年级（不应误判为高中）
- ✅ 识别置信度: ≥80%
- ✅ 知识点: 加法、减法、乘法、除法、图形

---

## 📊 后端日志检查点

### 1. 知识点提取日志

```
✅ [Knowledge Point Analyzer] 提取了 X 个知识点
```

**检查**:
- 高中试卷: X ≥ 10
- 初中试卷: X ≥ 5
- 小学试卷: X ≥ 3

---

### 2. 年级推断日志

```
✅ [Knowledge Point Analyzer] 推断年级: 高二 (置信度: XX%)
   理由: 基于 X 个知识点分析，X 个知识点指向 高二，频率 XX%，平均匹配置信度 XX%
```

**检查**:
- 推断年级正确
- 置信度 ≥ 85%
- 理由合理

---

### 3. 学段一致性日志

```
✅ [Knowledge Point Analyzer] 学段"高中"占比 XX%，学段判断准确
```

**检查**:
- 学段占比 ≥ 80%
- 无跨学段混淆

---

### 4. 多维度推断日志

```
✅ [Multi-Dimension Inferencer] 标题置信度高 (95%)，提高标题权重至 50%
✅ [Multi-Dimension Inferencer] 综合推断: 年级=高二, 学科=数学, 置信度=XX%
```

**检查**:
- 标题置信度 ≥ 90% 时，权重调整生效
- 综合推断结果正确
- 综合置信度 ≥ 85%

---

### 5. 质量评分日志

```
✅ [Quality Assurance] 质量评分: XX/100
   - 识别置信度: XX%
   - 分析置信度: XX%
   - 证据完整性: XX%
   - 内容可读性: XX%
```

**检查**:
- 总分 ≥ 90/100
- 各项指标合理

---

## 🔍 问题排查

### 问题1: 年级识别仍然错误

**可能原因**:
1. 知识点数据库未生效（后端未重启）
2. 标题中没有明确年级信息
3. 知识点提取失败

**排查步骤**:
1. 检查后端是否重启: `ps aux | grep node`
2. 检查知识点数据库: `cat backend/data/knowledge-points.json | grep "圆锥曲线"`
3. 检查后端日志中的知识点提取结果

---

### 问题2: 识别置信度过低

**可能原因**:
1. 知识点匹配数量少
2. 标题中年级信息不明确
3. 难度分布不典型

**排查步骤**:
1. 检查知识点提取数量
2. 检查标题识别结果
3. 检查难度分布

---

### 问题3: 质量评分低于90

**可能原因**:
1. 识别置信度低
2. 分析置信度低
3. 证据完整性不足

**排查步骤**:
1. 检查质量评分详细日志
2. 检查缺失字段
3. 检查改进建议

---

## ✅ 测试检查清单

### 功能测试

- [ ] 高二试卷识别正确
- [ ] 高一试卷识别正确
- [ ] 高三试卷识别正确
- [ ] 初二试卷不误判为高二
- [ ] 小学试卷不误判为高中

### 性能测试

- [ ] 识别置信度 ≥ 85%
- [ ] 知识点提取数量 ≥ 10个（高中）
- [ ] 质量评分 ≥ 90/100
- [ ] 分析时间 ≤ 60秒

### 日志验证

- [ ] 知识点提取日志正确
- [ ] 年级推断日志正确
- [ ] 学段一致性日志正确
- [ ] 多维度推断日志正确
- [ ] 质量评分日志正确

---

## 📝 测试报告模板

### 测试结果

**测试时间**: YYYY-MM-DD HH:MM  
**测试人员**: [姓名]  
**测试环境**: 本地开发环境

### 场景1: 高二数学试卷

| 指标 | 预期值 | 实际值 | 结果 |
|------|--------|--------|------|
| 年级识别 | 高二 | [实际] | ✅/❌ |
| 识别置信度 | ≥85% | [实际]% | ✅/❌ |
| 知识点数量 | ≥10个 | [实际]个 | ✅/❌ |
| 质量评分 | ≥90/100 | [实际]/100 | ✅/❌ |

### 场景2-5: [同上]

### 问题记录

1. [问题描述]
   - 严重程度: 高/中/低
   - 影响范围: [描述]
   - 解决方案: [描述]

### 总体评价

- 测试通过率: XX%
- 是否达到目标: ✅/❌
- 建议: [描述]

---

## 🎯 验收标准

### 必须满足（P0）

- ✅ 高二试卷识别正确率 = 100%
- ✅ 无跨学段误判（高中↔初中↔小学）
- ✅ 识别置信度 ≥ 85%

### 应该满足（P1）

- ✅ 知识点提取数量 ≥ 10个（高中试卷）
- ✅ 质量评分 ≥ 90/100
- ✅ 分析时间 ≤ 60秒

### 可以满足（P2）

- ✅ 所有学段识别准确率 ≥ 95%
- ✅ 识别置信度 ≥ 90%
- ✅ 质量评分 ≥ 95/100

---

**文档版本**: 1.0  
**创建时间**: 2026-01-11  
**更新时间**: 2026-01-11

