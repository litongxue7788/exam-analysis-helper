# 试卷信息验证功能 - 测试指南

## 🎯 测试目标

验证系统能够正确识别试卷中的年级信息，并在与用户输入冲突时优先使用试卷识别结果。

---

## 🧪 测试场景

### 场景1: 高中试卷 + 错误年级输入

**测试步骤**:
1. 打开前端页面: http://localhost:3000
2. 上传一份高中试卷（如"高一数学期中考试"）
3. 在基本信息中填写：
   - 年级: `三年级` (故意填错)
   - 学科: `数学`
4. 点击"开始分析"

**预期结果**:
- 后端日志显示验证报告，包含严重冲突警告
- 分析报告使用高中学段的语言风格和建议
- 练习题难度符合高中水平

**验证方法**:
- 查看后端控制台日志，应该看到：
  ```
  ⚠️ 严重冲突：用户填写年级"三年级"与试卷识别年级"高一"不匹配
  ```
- 查看分析报告的语言风格（应该是"专业、严肃、直击痛点"）

---

### 场景2: 初中试卷 + 未填写年级

**测试步骤**:
1. 上传一份初中试卷（如"七年级数学期中考试"）
2. 在基本信息中：
   - 年级: 留空
   - 学科: `数学`
3. 点击"开始分析"

**预期结果**:
- 后端日志显示自动识别年级为"七年级"
- 分析报告使用初中学段的语言风格
- 练习题难度符合初中水平

**验证方法**:
- 查看后端控制台日志，应该看到：
  ```
  已从试卷中自动识别年级：七年级
  ```

---

### 场景3: 小学试卷 + 正确年级

**测试步骤**:
1. 上传一份小学试卷（如"小学三年级数学期中考试"）
2. 在基本信息中填写：
   - 年级: `三年级`
   - 学科: `数学`
3. 点击"开始分析"

**预期结果**:
- 后端日志显示验证通过，无冲突
- 分析报告使用小学学段的语言风格（亲切、鼓励性）
- 练习题难度符合小学水平

**验证方法**:
- 查看后端控制台日志，应该看到：
  ```
  ✅ 所有信息验证通过，无冲突
  ```

---

### 场景4: 模糊年级 + 精确识别

**测试步骤**:
1. 上传一份高中试卷（如"高二数学期末考试"）
2. 在基本信息中填写：
   - 年级: `高中` (模糊)
   - 学科: `数学`
3. 点击"开始分析"

**预期结果**:
- 系统识别出更精确的"高二"
- 后端日志显示轻微警告（不完全一致）
- 分析报告使用"高二"的具体建议

**验证方法**:
- 查看后端控制台日志，应该看到：
  ```
  用户填写年级"高中"与试卷识别年级"高二"不完全一致，已使用试卷识别结果
  ```

---

## 📋 验证清单

### 后端日志检查
- [ ] 验证报告正确输出
- [ ] 年级识别准确
- [ ] 冲突警告清晰
- [ ] 置信度评估合理

### 分析报告检查
- [ ] 语言风格符合学段（小学亲切、初中理性、高中专业）
- [ ] 建议内容符合学段水平
- [ ] 练习题难度适配学段

### 练习题检查
- [ ] 题目难度符合识别的年级
- [ ] 知识点匹配学段要求
- [ ] 提示层次适合学段认知

---

## 🔍 日志查看方法

### Windows PowerShell
```powershell
# 查看后端日志
cd backend
npm run dev
# 日志会实时输出到控制台
```

### 关键日志标识
```
📋 试卷信息验证报告  ← 查找这个标题
⚠️ 验证警告:        ← 查找警告信息
✅ 所有信息验证通过  ← 查找成功信息
```

---

## 🐛 常见问题排查

### 问题1: 验证报告没有输出
**原因**: 后端服务未重启
**解决**: 
```bash
cd backend
npm run dev
```

### 问题2: 年级识别不准确
**原因**: 试卷标题中没有明确的年级信息
**解决**: 
- 检查试卷图片是否清晰
- 确认试卷标题是否包含年级关键词
- 查看后端日志中的 `extractedMeta.examName`

### 问题3: 分析风格没有变化
**原因**: 诊断提示词未使用验证后的年级
**解决**: 
- 确认 `backend/server.ts` 中 `diagnosisPrompt` 使用了 `effectiveGrade`
- 重启后端服务

---

## 📊 测试数据准备

### 推荐测试试卷
1. **高中试卷**: 使用项目根目录的高中试卷图片
2. **初中试卷**: 使用 `七年级数学期中考试` 相关文件
3. **小学试卷**: 使用 `小学三年级数学期中` 相关文件

### 测试年级输入
- 正确输入: `高一`、`七年级`、`三年级`
- 模糊输入: `高中`、`初中`、`小学`
- 错误输入: `三年级`（用于高中试卷）
- 空输入: 留空，测试自动识别

---

## ✅ 测试完成标准

- [ ] 所有4个场景测试通过
- [ ] 后端日志输出正确
- [ ] 分析报告风格符合学段
- [ ] 练习题难度适配学段
- [ ] 冲突警告清晰可见
- [ ] 自动识别功能正常

---

**测试环境**:
- 后端: http://localhost:3002
- 前端: http://localhost:3000
- 日志: 后端控制台实时输出
