# 数学科本地部署说明（Windows 管理人员版）

> 适用场景：在老师或管理人员的电脑上，本地运行“试卷分析助手（数学版）”，用于小范围为学生和家长生成分析报告。

---

## 一、环境准备（一次性）

1. 操作系统  
   - Windows 10 / 11

2. 必要软件  
   - **Node.js ≥ 18**  
     - 建议从官网安装：https://nodejs.org  
     - 安装完成后，打开 PowerShell，执行：  
       `node -v` 和 `npm -v` 确认版本正常。
   - **Git（可选，但推荐）**  
     - 方便从 GitHub 拉取项目和更新：`https://git-scm.com`

3. 文件位置约定  
   - 建议将项目放在：`D:\试卷分析助手`  
   - 目录结构示例：
     - `backend/` 后端服务（数学分析 + AI 调用）
     - `frontend/web/` 前端网页（数据录入 + 报告展示）
     - 若干 CSV 示例：`七年级数学期中考试-学生成绩.csv` 等

---

## 二、首次安装步骤

### 2.1 获取项目代码

如果使用 Git：

```powershell
cd D:\
git clone https://github.com/litongxue7788/exam-analysis-helper.git "试卷分析助手"
cd "D:\试卷分析助手"
```

如果已经有完整项目文件夹（例如通过 U 盘拷贝），直接确认目录为：`D:\试卷分析助手` 即可。

### 2.2 安装后端依赖（一次）

```powershell
cd "D:\试卷分析助手\backend"
npm install
```

说明：
- 该命令会安装 Express、OpenAI SDK、TypeScript 等依赖。
- 只在首次或项目更新依赖时执行即可。

### 2.3 配置后端 .env（一次）

后端需要通过大模型厂商提供的 API Key 才能生成分析报告。

1. 在 `D:\试卷分析助手\backend` 目录下，创建或编辑 `.env` 文件。  
2. 按照所选厂商填入以下环境变量（示例为豆包 / 阿里云 / 智谱三种，可按需选择）：

```env
DOUBAO_API_KEY=your_doubao_api_key
DOUBAO_MODEL_ID=your_doubao_model_id

ALIYUN_API_KEY=your_aliyun_api_key
ALIYUN_MODEL_ID=qwen-plus

ZHIPU_API_KEY=your_zhipu_api_key
ZHIPU_MODEL_ID=glm-4
```

注意：
- 该文件 **只保存在本机**，不要上传到 GitHub 或发给他人。
- 实际使用时只需要配置你打算使用的一个厂商即可（例如只用豆包），其他可以留空。

### 2.4 安装前端依赖（一次）

```powershell
cd "D:\试卷分析助手\frontend\web"
npm install
```

说明：
- 会安装 React、Vite 等依赖。
- 同样只在首次或前端代码更新时执行。

---

## 三、日常使用：启动服务 + 生成报告

每次需要使用本工具时，建议按以下步骤：

### 3.1 启动后端服务（数学分析接口）

1. 打开 PowerShell（终端 1），执行：

```powershell
cd "D:\试卷分析助手\backend"
npx ts-node server.ts
```

2. 看到类似输出即表示启动成功：

```text
🚀 后端服务已启动: http://localhost:3002
👉 分析接口地址: http://localhost:3002/api/analyze-exam
```

> 注意：这一窗口需要保持打开，不要关闭。关闭后前端将无法调用 AI 接口。

### 3.2 启动前端网页（老师操作界面）

1. 再打开一个新的 PowerShell（终端 2），执行：

```powershell
cd "D:\试卷分析助手\frontend\web"
npm run dev
```

2. 正常情况下，终端会显示类似信息：

```text
VITE v5.x  ready in Xs
  ➜  Local:   http://localhost:3000/
```

3. 用浏览器打开：`http://localhost:3000`  
   - 建议使用 Chrome / Edge。

此时即可在浏览器中看到首页“试卷分析助手”界面。

---

## 四、老师/管理人员的操作流程（数学版）

### 4.1 录入数据

1. 打开 `http://localhost:3000`。
2. 在顶部区域填写或确认学生信息（姓名、年级、班级、科目为“数学”等）。
3. 在“本次考试数据录入”区域，有两种方式：
   - 拍照录入（需要后端 + AI 接口稳定，适合试卷图片）
   - 表格导入（推荐）：上传包含学生成绩的 CSV 文件。
4. 对于数学本地试用，推荐优先使用 **表格导入**：
   - 使用示例 CSV 作为模板（项目根目录已有样例）；
   - 确保表头与系统预期一致（如“学生姓名”“总分”等字段）。

### 4.2 生成个人分析报告

1. 成功导入数据后，首页中部会显示“本次考试概览（当前学生）”。
2. 点击底部绿色按钮：`生成个人分析报告`。
3. 系统会：
   - 将数据发送到本地后端（端口 3002）；
   - 后端构造 Prompt 调用大模型生成分析；
   - 前端展示包含以下模块的报告：
     - 成绩摘要
     - 整体评价
     - 主要问题（薄弱知识点）
     - 关键错题
     - 结论与建议
     - 题型能力分析
4. 老师可选择：
   - 直接在电脑上展示给学生/家长；
   - 使用浏览器的“打印/导出为 PDF”功能生成纸质或电子版报告。

### 4.3 查看历史记录与趋势

1. 回到首页，点击底部左侧 `切换考试`。
2. 弹出的“历史考试记录”中：
   - 可以切换不同考试的结果；
   - 点击“学情趋势分析”卡片，查看多次考试成绩和能力变化趋势。

---

## 五、常见问题与排查

### 5.1 浏览器提示“分析失败: API error”

可能原因：
- 后端服务未启动或已关闭；
- `.env` 中的大模型 API Key 未配置或失效；
- 当前电脑无法访问大模型厂商的网络。

排查步骤：
1. 检查后端终端是否仍在运行，有无报错信息。
2. 确认 `.env` 中的 API Key 是否正确且未过期。
3. 尝试在浏览器访问 `http://localhost:3002/`，看是否能打开后端健康检查页面。

### 5.2 端口冲突（3000 或 3002 被占用）

症状：
- 前端启动时报端口 3000 已被占用；
- 后端启动时报端口 3002 已被占用。

处理办法：
- 关闭占用该端口的其他程序（或重启电脑）；
- 如需修改端口：
  - 前端端口在 `frontend/web/vite.config.ts` 中的 `server.port`；
  - 后端端口在 `backend/server.ts` 中的 `PORT` 常量。

---

## 六、建议的日常使用习惯

- 每次集中的分析工作前：
  - 先启动后端，再启动前端；
  - 准备好规范的成绩 CSV 和题目结构 CSV。
- 分析完成后：
  - 将生成的报告保存为 PDF 或截图留存；
  - 适时整理典型报告，用于向校领导或家长展示效果。

---

> 提示：本说明仅针对“数学本地部署”场景。未来扩展语文、英语及多学段支持时，可在此文档基础上增加相应学科与学段的特殊说明。***
