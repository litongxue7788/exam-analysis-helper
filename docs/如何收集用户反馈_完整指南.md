# 📊 如何收集用户反馈 - 完整指南

**日期**: 2026-01-12  
**状态**: ✅ 系统已就绪

## 🎯 反馈系统概述

我们的应用有完整的用户反馈系统，用户可以在报告页面提交反馈，开发者可以查看和分析这些反馈。

## 📍 反馈数据存储位置

**文件路径**: `data/feedbacks/user-feedbacks.jsonl`

**格式**: JSONL (每行一个 JSON 对象)

**注意**: 
- 目录会在第一次提交反馈时自动创建
- 如果文件不存在，说明还没有用户提交过反馈

## 🔄 反馈收集流程

### 第1步：用户提交反馈

1. **用户打开报告页面**
   - 完成分析后自动显示报告
   - 或从历史记录打开已有报告

2. **用户看到反馈按钮**
   - 位置：报告页面右下角
   - 样式：带脉冲动画的圆形按钮
   - 图标：笑脸或消息图标

3. **用户点击反馈按钮**
   - 弹出反馈表单
   - 表单包含：
     - 反馈类型（分析准确/分析不准/功能建议/其他问题）
     - 评分（1-5星）
     - 详细内容（可选）

4. **用户提交反馈**
   - 点击"提交反馈"按钮
   - 系统发送到后端 API
   - 后端保存到 JSONL 文件

### 第2步：开发者查看反馈

#### 方法1: 使用查看脚本（推荐）

```bash
node view-feedbacks.js
```

**输出示例**:
```
📊 用户反馈统计

总反馈数: 5
平均评分: 4.2 ⭐

📋 反馈列表:

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
反馈 #1
时间: 2026-01-12 14:30:25
类型: 分析准确
评分: ⭐⭐⭐⭐⭐ (5/5)
内容: 分析非常准确，错题定位精准！
用户: 七年级 | 数学
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### 方法2: 直接查看文件

```bash
# Windows PowerShell
Get-Content data/feedbacks/user-feedbacks.jsonl

# Windows CMD
type data\feedbacks\user-feedbacks.jsonl

# 或用记事本打开
notepad data\feedbacks\user-feedbacks.jsonl
```

#### 方法3: 使用 API 接口

```bash
# 获取反馈摘要
curl http://localhost:3002/api/feedback/summary

# 或在浏览器中访问
http://localhost:3002/api/feedback/summary
```

## 📝 反馈数据结构

每条反馈记录包含以下字段：

```json
{
  "id": "feedback-1736672425123-abc123",
  "timestamp": 1736672425123,
  "feedbackType": "accurate",
  "rating": 5,
  "content": "分析非常准确，错题定位精准！",
  "analysisId": "job-abc123",
  "userInfo": {
    "grade": "七年级",
    "subject": "数学"
  }
}
```

**字段说明**:
- `id`: 反馈唯一标识
- `timestamp`: 提交时间戳
- `feedbackType`: 反馈类型
  - `accurate`: 分析准确
  - `inaccurate`: 分析不准
  - `suggestion`: 功能建议
  - `issue`: 其他问题
- `rating`: 评分 (1-5)
- `content`: 详细内容（可选）
- `analysisId`: 关联的分析作业ID（可选）
- `userInfo`: 用户信息（年级、学科）

## 🧪 测试反馈系统

### 快速测试步骤

1. **启动服务**（如果还没启动）
   ```bash
   # 后端
   cd backend
   node dist/server.js
   
   # 前端（新终端）
   cd frontend/web
   npm run dev
   ```

2. **打开应用**
   - 访问: http://localhost:3000

3. **进行一次分析**
   - 上传试卷图片
   - 等待分析完成
   - 查看报告

4. **提交测试反馈**
   - 点击右下角反馈按钮
   - 选择"分析准确"
   - 评分 5 星
   - 填写内容："测试反馈系统"
   - 点击提交

5. **验证反馈已保存**
   ```bash
   node view-feedbacks.js
   ```

## 📊 反馈分析

### 查看反馈统计

```bash
node view-feedbacks.js
```

**统计信息包括**:
- 总反馈数
- 平均评分
- 各类型反馈数量
- 最新反馈列表

### 导出反馈数据

```bash
# 复制反馈文件
copy data\feedbacks\user-feedbacks.jsonl feedbacks-backup.jsonl

# 或导出为 CSV（需要额外脚本）
# 可以用 Excel 打开 JSONL 文件进行分析
```

### 分析反馈趋势

可以编写脚本分析：
- 评分趋势
- 常见问题
- 功能需求
- 用户满意度

## 🔧 故障排查

### 问题1: 反馈按钮不显示

**检查清单**:
- [ ] 分析是否已完成？
- [ ] 是否从历史记录打开？
- [ ] 浏览器控制台是否有错误？

**解决方案**: 参考 `立即测试_历史记录和反馈按钮修复.md`

### 问题2: 提交反馈失败

**可能原因**:
- 后端服务未启动
- 网络连接问题
- API 参数错误

**检查方法**:
```bash
# 检查后端服务
curl http://localhost:3002/api/health

# 查看后端日志
# 在后端服务的终端窗口查看输出
```

### 问题3: 反馈文件不存在

**原因**: 还没有用户提交过反馈

**解决方案**: 
1. 进行一次完整的分析
2. 提交一条测试反馈
3. 文件会自动创建

### 问题4: 无法读取反馈文件

**检查权限**:
```bash
# 检查文件是否存在
Test-Path data/feedbacks/user-feedbacks.jsonl

# 检查文件内容
Get-Content data/feedbacks/user-feedbacks.jsonl
```

## 💡 最佳实践

### 1. 定期查看反馈

建议每天查看一次用户反馈：
```bash
node view-feedbacks.js
```

### 2. 及时响应问题

对于"分析不准"和"其他问题"类型的反馈：
- 记录问题详情
- 分析原因
- 制定改进计划

### 3. 收集功能需求

对于"功能建议"类型的反馈：
- 整理需求列表
- 评估优先级
- 规划开发计划

### 4. 备份反馈数据

定期备份反馈文件：
```bash
# 创建备份
copy data\feedbacks\user-feedbacks.jsonl backups\feedbacks-2026-01-12.jsonl
```

### 5. 分析反馈趋势

每周或每月分析：
- 平均评分变化
- 常见问题类型
- 用户满意度趋势

## 📈 反馈数据应用

### 1. 产品改进

根据反馈优化：
- 分析准确度
- 用户界面
- 功能完善

### 2. 质量监控

监控指标：
- 平均评分
- 负面反馈比例
- 问题类型分布

### 3. 用户洞察

了解用户：
- 使用场景
- 痛点问题
- 期望功能

## 🎯 下一步行动

### 立即行动

1. **测试反馈系统**
   - 进行一次完整分析
   - 提交测试反馈
   - 验证反馈已保存

2. **查看反馈**
   ```bash
   node view-feedbacks.js
   ```

3. **设置定期检查**
   - 每天查看新反馈
   - 每周分析反馈趋势

### 长期规划

1. **建立反馈处理流程**
   - 反馈分类
   - 优先级评估
   - 响应机制

2. **开发反馈分析工具**
   - 自动统计
   - 趋势图表
   - 报告生成

3. **持续改进产品**
   - 根据反馈优化
   - 定期发布更新
   - 通知用户改进

## 📞 需要帮助？

如果遇到问题：

1. **查看文档**
   - `如何查看用户反馈.md`
   - `今日工作完成_2026-01-12_反馈系统使用指南.md`

2. **检查日志**
   - 浏览器控制台
   - 后端服务日志

3. **联系开发团队**
   - 提供错误信息
   - 描述问题场景
   - 附上截图

---

## 🎉 总结

反馈系统已完全就绪：
- ✅ 用户可以轻松提交反馈
- ✅ 反馈自动保存到文件
- ✅ 开发者可以方便查看
- ✅ 支持多种查看方式

现在就开始收集用户反馈，持续改进产品吧！ 🚀

---

**创建时间**: 2026-01-12 22:30  
**最后更新**: 2026-01-12 22:30  
**状态**: ✅ 完整指南
