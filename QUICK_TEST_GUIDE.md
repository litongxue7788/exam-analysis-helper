# 🚀 快速测试指南

## ✅ 当前状态

- ✅ 后端服务运行中: http://localhost:3002 (Process ID: 7)
- ✅ 前端服务运行中: http://localhost:3000 (Process ID: 3)
- ✅ 所有集成已完成
- ✅ 单元测试通过

---

## 🧪 测试方法

### 方法 1: 使用前端界面（推荐）

1. **打开浏览器**
   ```
   http://localhost:3000
   ```

2. **上传试卷**
   - 点击"上传试卷"按钮
   - 选择试卷图片（可以使用桌面上的 4 张图片）
   - 或者拖拽图片到上传区域

3. **填写基本信息**
   - 年级: 故意填错（例如：小学一年级）
   - 学科: 故意填错（例如：语文）
   - **目的**: 测试系统是否忽略错误输入

4. **开始分析**
   - 点击"开始分析"按钮
   - 等待 2-3 分钟（OCR + LLM 分析）

5. **查看结果**
   - 检查识别的年级和学科是否正确
   - 查看是否有警告信息（用户输入与识别结果不一致）
   - 确认所有输出内容与试卷匹配

---

### 方法 2: 使用测试脚本

#### 测试桌面图片
```bash
node test_desktop_images_simple.js
```

**说明**:
- 自动上传桌面上的 4 张图片
- 故意填写错误的年级和学科
- 等待分析完成
- 显示识别结果和警告信息

#### 查看任务状态
```bash
node check_job.js <jobId>
```

**说明**:
- 查询指定任务的状态
- 显示识别信息和置信度
- 保存完整结果到 `job_result.json`

---

## 🎯 测试场景

### 场景 1: 高中试卷 + 错误用户输入
- **试卷**: 高一数学期中考试
- **用户输入**: 小学三年级 + 语文
- **预期结果**: 
  - ✅ 系统识别为"高一 + 数学"
  - ✅ 忽略用户输入
  - ✅ 显示警告信息

### 场景 2: 初中试卷 + 正确用户输入
- **试卷**: 初二数学期中考试
- **用户输入**: 初二 + 数学
- **预期结果**:
  - ✅ 系统识别为"初二 + 数学"
  - ✅ 与用户输入一致
  - ✅ 无警告信息

### 场景 3: 小学试卷 + 错误用户输入
- **试卷**: 三年级数学期中考试
- **用户输入**: 高中 + 语文
- **预期结果**:
  - ✅ 系统识别为"三年级 + 数学"
  - ✅ 忽略用户输入
  - ✅ 显示警告信息

---

## 📊 如何验证成功

### 1. 检查识别信息
在分析结果中，应该看到 `recognitionInfo` 字段:
```json
{
  "recognitionInfo": {
    "grade": "三年级",
    "subject": "数学",
    "confidence": {
      "level": "medium",
      "score": 0.72
    },
    "source": "recognition",
    "warnings": [
      "⚠️ 用户输入年级\"小学一年级\"与识别结果\"三年级\"不一致，已使用识别结果"
    ]
  }
}
```

### 2. 检查警告信息
如果用户输入与识别结果不一致，应该看到警告:
- ⚠️ 用户输入年级"XXX"与识别结果"YYY"不一致，已使用识别结果
- ⚠️ 用户输入学科"XXX"与识别结果"YYY"不一致，已使用识别结果

### 3. 检查输出内容
- 诊断报告中的知识点应该与试卷匹配
- 练习题应该与试卷难度和知识点匹配
- 学习方法应该适合识别的年级

### 4. 检查后端日志
在后端控制台中，应该看到:
```
🚀 [Content-Driven Analysis] 开始基于试卷内容的智能推断...
✅ [Knowledge Point Analyzer] 提取了 X 个知识点
✅ [Multi-Dimension Inferencer] 综合推断: 年级=XXX, 学科=YYY, 置信度=ZZ%
✅ [Confidence Evaluator] 置信度评估: medium (XX%)
✅ [Output Binder] 创建绑定上下文: 年级=XXX, 学科=YYY, 来源=recognition
⚠️ 用户输入年级"AAA"与识别结果"XXX"不一致，已使用识别结果
```

---

## 🐛 常见问题

### 问题 1: 前端无法访问
**症状**: 浏览器无法打开 http://localhost:3000

**解决方案**:
```bash
# 检查前端服务是否运行
# 如果没有运行，启动前端服务
cd frontend/web
npm run dev
```

### 问题 2: 后端无法访问
**症状**: 前端显示"无法连接到后端"

**解决方案**:
```bash
# 检查后端服务是否运行
# 如果没有运行，启动后端服务
cd backend
npm run dev
```

### 问题 3: 分析失败
**症状**: 点击"开始分析"后显示错误

**解决方案**:
1. 检查后端日志，查看错误信息
2. 确认 API Key 是否配置正确（`backend/.env`）
3. 确认图片格式是否支持（JPG, PNG）
4. 确认图片大小是否合理（< 10MB）

### 问题 4: 识别结果不准确
**症状**: 系统识别的年级或学科不正确

**可能原因**:
1. 试卷标题不清晰
2. 知识点不在知识点库中
3. 试卷难度与年级不匹配

**解决方案**:
1. 查看置信度评估结果
2. 如果置信度低于 50%，建议人工确认
3. 考虑扩充知识点库

### 问题 5: 没有警告信息
**症状**: 用户输入与识别结果不一致，但没有显示警告

**可能原因**:
1. 前端没有显示 `recognitionInfo.warnings` 字段
2. 后端日志中应该有警告信息

**解决方案**:
1. 检查后端日志，确认警告信息是否生成
2. 检查前端代码，确认是否显示警告信息
3. 查看 `job_result.json` 文件，确认警告信息是否存在

---

## 📝 测试检查清单

使用以下检查清单验证系统是否正常工作:

- [ ] 前端服务运行正常 (http://localhost:3000)
- [ ] 后端服务运行正常 (http://localhost:3002)
- [ ] 可以上传试卷图片
- [ ] 可以填写基本信息
- [ ] 点击"开始分析"后显示进度
- [ ] 分析完成后显示结果
- [ ] 结果中包含 `recognitionInfo` 字段
- [ ] 识别的年级和学科正确
- [ ] 用户输入与识别结果不一致时显示警告
- [ ] 诊断报告内容与试卷匹配
- [ ] 练习题内容与试卷匹配
- [ ] 学习方法适合识别的年级
- [ ] 后端日志显示完整的推断过程

---

## 🎉 成功标准

如果以下所有条件都满足，说明系统工作正常:

1. ✅ 系统能够正确识别试卷的年级和学科
2. ✅ 系统完全忽略错误的用户输入
3. ✅ 系统使用识别结果生成所有输出
4. ✅ 系统显示警告信息（当用户输入与识别结果不一致时）
5. ✅ 所有输出内容与试卷匹配
6. ✅ 置信度评估合理
7. ✅ 后端日志显示完整的推断过程

---

## 📞 需要帮助？

如果遇到问题，请查看:
- 完整集成报告: `INTEGRATION_COMPLETE.md`
- 设计文档: `.kiro/specs/content-driven-analysis/design.md`
- 集成指南: `.kiro/specs/content-driven-analysis/SERVER_INTEGRATION_GUIDE.md`
- 行动计划: `ACTION_PLAN.md`

或者查看后端日志，了解详细的错误信息。

---

**祝测试顺利！** 🚀
